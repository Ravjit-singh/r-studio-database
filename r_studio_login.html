<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Login ??? Expense Tracker</title>

  <!-- Fonts & icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZmPZ7lYEQXcXnGj3fP0yGr3V07s4fQ9r5iNQ0xUXpP+SwEvvxFfVZJBV5xW+Z3zYKg=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer" />

  <style>
    :root{
      --bg-1:#07070c; --bg-2:#0f1118;
      --accent:#00bfa5; --accent-2:#00ffc2;
      --muted:rgba(255,255,255,0.65);
      --radius-xl:28px; --shadow-soft:0 8px 30px rgba(0,0,0,0.6);
      --glass-border: rgba(255,255,255,0.06);
      --poppins:'Poppins', system-ui, -apple-system, "SF Pro Text";
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }

    *{box-sizing:border-box;margin:0;padding:0;font-family:var(--poppins)!important}
    html,body{height:100%}
    body{
      background:var(--bg-1);
      color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;
      padding:calc(18px + var(--safe-top)) 16px calc(28px + var(--safe-bottom));
      -webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;overflow:hidden;
    }

    canvas#bgCanvas{
      position:fixed; inset:0; width:100%; height:100%;
      z-index:0; pointer-events:none;
    }

    .login-card{
      position:relative; z-index:1;
      width:100%; max-width:420px; padding:36px; border-radius:var(--radius-xl);
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid var(--glass-border);
      box-shadow:var(--shadow-soft);
      backdrop-filter: blur(16px) saturate(120%);
      display:flex;flex-direction:column;gap:20px;align-items:center;
      animation:cardIn .42s cubic-bezier(.2,.9,.25,1);
      transform-style:preserve-3d;
      perspective:1200px;
      transition: transform 0.3s ease-out;
    }
    @keyframes cardIn{from{opacity:0;transform:translateY(22px)}to{opacity:1;transform:translateY(0)}}

    .avatar{width:78px;height:78px;border-radius:20px;display:flex;align-items:center;justify-content:center;
            background:linear-gradient(135deg, rgba(0,191,165,0.18), rgba(0,191,165,0.05));
            border:1px solid rgba(255,255,255,0.05);box-shadow:0 0 30px rgba(0,191,165,0.18);}
    .avatar i{font-size:30px;color:var(--accent);}
    .avatar svg{width:30px;height:30px;fill:var(--accent);}

    .title{text-align:center}
    .title h1{font-size:26px;font-weight:700;margin-bottom:6px;letter-spacing:-0.3px}
    .title p{font-size:14px;color:var(--muted)}

    .field{width:100%;display:flex;flex-direction:column;gap:8px}
    .pill{display:flex;align-items:center;gap:10px;padding:16px;border-radius:16px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);width:100%;transition:box-shadow 0.25s, border-color 0.25s;}
    .pill input{background:transparent;border:none;outline:none;color:#fff;font-size:16px;width:100%}
    .pill:focus-within{border-color:var(--accent);box-shadow:0 8px 24px rgba(0,191,165,0.12)}

    button.btn{cursor:pointer;border:none;outline:none;width:100%;padding:16px;border-radius:16px;font-weight:700;font-size:17px;transition:transform .2s ease, box-shadow .2s ease;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 12px 35px rgba(0,191,165,0.22)}
    button.btn:hover{transform:translateY(-2px) scale(1.02);box-shadow:0 16px 45px rgba(0,191,165,0.28)}
    button.btn:active{transform:translateY(0) scale(0.98)}

    .footer{text-align:center;font-size:12px;color:var(--muted);}
    .fa-fallback{display:none}
    @media(max-width:420px){ .login-card{padding:28px} .title h1{font-size:22px} button.btn{font-size:15px;padding:14px} }
  </style>
</head>
<body>
  <canvas id="bgCanvas" aria-hidden="true"></canvas>

  <div class="login-card" role="main" aria-labelledby="loginTitle">
    <div class="avatar" aria-hidden="true">
      <i class="fa-solid fa-user" aria-hidden="true"></i>
      <svg class="fa-fallback" aria-hidden="true" viewBox="0 0 24 24" style="display:none;">
        <path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/>
      </svg>
    </div>

    <div class="title" id="loginTitle">
      <h1>Welcome Back</h1>
      <p>Sign in to continue coding you Projects</p>
    </div>

    <div class="field">
      <div class="pill"><input id="username" type="text" placeholder="Username" autocomplete="username"></div>
    </div>

    <div class="field">
      <div class="pill"><input id="password" type="password" placeholder="Password" autocomplete="current-password"></div>
    </div>

    <button id="loginBtn" class="btn" aria-label="Login">Login</button>

    <div class="footer" id="loginFooter">Your data is securely stored and synced</div>
  </div>

<script>
/* ===== Teal blobs cinematic background ===== */
(function(){
  const canvas = document.getElementById('bgCanvas');
  const ctx = canvas.getContext('2d');
  let w = canvas.width = innerWidth, h = canvas.height = innerHeight;

  window.addEventListener('resize', ()=>{ w = canvas.width = innerWidth; h = canvas.height = innerHeight; });

  const blobs = [];
  const colors = ['rgba(0,191,165,0.15)','rgba(0,255,192,0.12)','rgba(0,191,165,0.1)'];
  for(let i=0;i<6;i++){
    blobs.push({
      x: Math.random()*w,
      y: Math.random()*h,
      r: 80+Math.random()*200,
      dx: (Math.random()-0.5)*0.3,
      dy: (Math.random()-0.5)*0.3,
      color: colors[i%colors.length]
    });
  }

  function animate(){
    ctx.clearRect(0,0,w,h);
    for(const b of blobs){
      b.x += b.dx; b.y += b.dy;
      if(b.x<-200) b.x=w+200; if(b.x>w+200) b.x=-200;
      if(b.y<-200) b.y=h+200; if(b.y>h+200) b.y=-200;
      const g = ctx.createRadialGradient(b.x,b.y,b.r*0.1,b.x,b.y,b.r);
      g.addColorStop(0,b.color);
      g.addColorStop(1,'rgba(0,191,165,0)');
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);
    }
    requestAnimationFrame(animate);
  }
  animate();
})();

/* ===== Font Awesome fallback ===== */
(function(){
  const i = document.querySelector('.avatar i');
  const svg = document.querySelector('.avatar .fa-fallback');
  const pseudo = window.getComputedStyle(i,'::before').content || '';
  if(!pseudo || pseudo === 'none' || pseudo === '""' || pseudo === '" "' ){
    i.style.display='none';
    svg.style.display='block';
  }
})();

/* ===== Card tilt effect ===== */
(function(){
  const card = document.querySelector('.login-card');
  const ease = 0.1;
  const mouse = {x: window.innerWidth/2, y: window.innerHeight/2};
  const smooth = {x: mouse.x, y: mouse.y};

  window.addEventListener('mousemove', e=>{
    mouse.x = e.clientX; mouse.y = e.clientY;
  });

  function update(){
    smooth.x += (mouse.x - smooth.x)*ease;
    smooth.y += (mouse.y - smooth.y)*ease;
    const dx = (smooth.x - window.innerWidth/2)/window.innerWidth;
    const dy = (smooth.y - window.innerHeight/2)/window.innerHeight;
    card.style.transform = `rotateX(${-dy*8}deg) rotateY(${dx*10}deg)`;
    requestAnimationFrame(update);
  }
  update();
})();

/* ===== Input & Button Animations ===== */
const pills = document.querySelectorAll('.pill input');
pills.forEach(input=>{
  input.addEventListener('focus', e=>{
    input.parentElement.style.boxShadow='0 8px 24px rgba(0,191,165,0.12)';
  });
  input.addEventListener('blur', e=>{
    input.parentElement.style.boxShadow='none';
  });
});

/* ===== Login logic (Apps Script) ===== */
document.getElementById('loginBtn').addEventListener('click', async function(){
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const footer = document.getElementById('loginFooter');

  if(!username || !password){
    footer.textContent = 'Please enter both username and password';
    footer.style.color = '#00ffc2';
    setTimeout(()=>{ footer.textContent='Your data is securely stored and synced'; footer.style.color=''; },2500);
    return;
  }

  footer.textContent = 'Verifying...';
  footer.style.color = '#00bfa5';

  try {
    const res = await fetch(
      "https://script.google.com/macros/s/AKfycbzalDlJ_gjZAOkPjHRsiV-GCk6ruIlXTZtAgFFmBxYUC2ZxvWGOlXckP0Js10H3RkjZiw/exec"
      + "?mode=login"
      + "&userId=" + encodeURIComponent(username)
      + "&password=" + encodeURIComponent(password)
    );

    const data = await res.json();
    footer.textContent = data.message;
    footer.style.color = data.status === "success" ? '#00ffc2' : '#00bfa5';

    if(data.status === "success"){
      localStorage.setItem('userId', data.user.UserId);
      localStorage.setItem('role', data.user.Role);
      localStorage.setItem('docId', data.user.DocId || "");
      setTimeout(()=>{ window.location.href = 'editor.html'; },1200); // redirect to your editor page
    }
  } catch (err) {
    footer.textContent = 'Error connecting to server!';
    footer.style.color = '#00bfa5';
  }
});
</script>
</body>
</html>